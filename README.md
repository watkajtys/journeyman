# Visual Story Editor for Generative Adventures

This project is a web-based visual editor for creating "Choose Your Own Adventure" (CYOA) style games where the story's illustrations are dynamically generated by AI. It provides a user-friendly interface for building complex, branching narratives and connecting them to a powerful generative AI model.

This editor was built to manage the story content for a [Generative Adventure Game](https://github.com/your-username/generative-adventure-game) (link to the game's repository).

## Features

*   **Visual Node-Based Editor**: Create, connect, and organize story nodes using a simple drag-and-drop interface powered by ReactFlow.
*   **Dynamic Story Generation**: Write text and detailed image prompts for each node in the story.
*   **Consistent Element Management**: Define and reuse consistent elements across your story, such as style guides, characters, and locations, to maintain narrative cohesion.
*   **AI-Powered Image Generation**: Generate images for each node directly within the editor using Google's Gemini API.
*   **Cloud Storage**: Save and load your story data to the cloud using Cloudflare Workers and KV storage.

## Technology Stack

*   **Frontend**:
    *   [React](https://reactjs.org/): A JavaScript library for building user interfaces.
    *   [ReactFlow](https://reactflow.dev/): A library for building node-based editors and interactive diagrams.
    *   [Vite](https://vitejs.dev/): A fast frontend build tool.
*   **Backend**:
    *   [Cloudflare Workers](https://workers.cloudflare.com/): A serverless execution environment for running backend logic.
    *   [Cloudflare KV](https://developers.cloudflare.com/workers/runtime-apis/kv/): A global, low-latency key-value data store.
*   **Generative AI**:
    *   [Google Gemini](https://ai.google.dev/): Used for generating images from text prompts.

## Getting Started

### Prerequisites

*   [Node.js](https://nodejs.org/) (v16 or later)
*   [npm](https://www.npmjs.com/)
*   A [Cloudflare account](https://dash.cloudflare.com/sign-up)
*   A [Google AI Studio API key](https://aistudio.google.com/app/apikey)

### Installation and Setup

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/visual-story-editor.git
    cd visual-story-editor
    ```

2.  **Install backend dependencies:**
    The backend is a Cloudflare Worker. Its dependencies are managed in the root `package.json`.
    ```bash
    npm install
    ```

3.  **Install frontend dependencies:**
    The frontend is a React application located in the `editor_react` directory.
    ```bash
    cd editor_react
    npm install
    cd ..
    ```

### Configuration

1.  **Cloudflare KV Store:**
    *   You need to create a KV namespace to store your story data. You can do this through the Cloudflare dashboard or using the `wrangler` CLI.
    *   Once created, add the namespace binding to your `wrangler.toml` file:
        ```toml
        [[kv_namespaces]]
        binding = "STORY_STORAGE"
        id = "your-kv-namespace-id"
        preview_id = "your-kv-namespace-preview-id"
        ```

2.  **Gemini API Key:**
    *   The editor needs a Google Gemini API key to generate images.
    *   Open `editor_react/src/components/NodeEditorPanel.jsx` and replace the placeholder `API_KEY` with your actual key.
        ```javascript
        // This should be stored securely in a real app, e.g., in environment variables.
        const API_KEY = 'YOUR_GEMINI_API_KEY_HERE';
        ```
    *   **Note:** For a production application, you should not hardcode the API key in the frontend. Instead, consider using a backend endpoint to proxy the API calls and store the key securely in Cloudflare's environment variables.

### Running the Development Server

1.  **Start the Cloudflare Worker:**
    In the root directory, run:
    ```bash
    npm run start
    ```
    This will start the development server for the backend worker, typically on `http://localhost:8787`.

2.  **Start the React App:**
    In a separate terminal, navigate to the `editor_react` directory and run:
    ```bash
    cd editor_react
    npm run dev
    ```
    This will start the Vite development server for the React app, typically on `http://localhost:5173`.

3.  **Open the editor:**
    Open your browser and navigate to `http://localhost:5173`. The editor should now be running.

## Deployment

This project is designed to be deployed to [Cloudflare Pages](https://pages.cloudflare.com/).

1.  **Connect your repository to Cloudflare Pages:**
    *   In the Cloudflare dashboard, go to **Workers & Pages** and create a new application.
    *   Connect your GitHub repository.

2.  **Configure the build settings:**
    *   **Framework preset**: `Vite`
    *   **Build command**: `npm run build`
    *   **Build output directory**: `dist`
    *   **Root directory**: `editor_react`

3.  **Add environment variables:**
    *   You will need to set up your KV namespace binding for the production environment in the Cloudflare Pages settings.

4.  **Deploy:**
    *   Save and deploy your application. Cloudflare Pages will automatically build and deploy your site.
